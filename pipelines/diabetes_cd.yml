parameters:
  - name: artifactBuildID
    displayName: Model CI Build ID
    type: string
    default: latest

pr: none
trigger: none

resources:
  containers:
    - container: mlops
      image: mcr.microsoft.com/mlops/python:latest
  pipelines:
    - pipeline: DiabetesRegression
      source: diabetes_regression_pipeline
      trigger:
        branches:
          include:
            - 'main'
            - 'iaac'

variables:
  - group: devopsforai-aml-vg
  - template: diabetes_variables_template.yml

stages:
  - stage: Deploy_ACI
    displayName: Deploy to ACI
    condition: variables['ACI_DEPLOYMENT_NAME']
    jobs:
      - job: ACI_Deployment
        displayName: ACI Deployment
        container: mlops
        timeoutInMinutes: 0
        steps: 
          - download: none
          - template: diabetes_get_model_artifacts.yml
            parameters:
              projectID: 'resources.pipeline.model-train-ci.projectID'
              pipelineID: 'resources.pipeline.model-train-ci.pipelineID'
              artifactBuildID: '{{ paramters.artifactBuildID }}'
  