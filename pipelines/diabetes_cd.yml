parameters:
  - name: artifactBuildID
    displayName: Model CI Build ID
    type: string
    default: latest

pr: none
trigger: none

resources:
  containers:
    - container: mlops
      image: mcr.microsoft.com/mlops/python:latest
  pipelines:
    - pipeline: Model-Train-CI
      source: Model-Train-Register-CI
      trigger:
        branches:
          include:
          - master

variables:
  - group: mlops-diabets-aml-vg
  - template: diabetes_variables_template.yml

stages:
  - stage: Deploy_ACI
    displayName: Deploy to ACI
    condition: variables['ACI_DEPLOYMENT_NAME']
    jobs:
      - job: ACI_Deployment
        displayName: ACI Deployment
        container: mlops
        timeoutInMinutes: 0
        steps: 
          - download: none
          - template: diabetes_get_model_artifacts.yml
            parameters:
              projectID: 'resources.pipeline.Model-Train-CI.projectID'
              pipelineID: 'resources.pipeline.Model-Train-CI.pipelineID'
              artifactBuildID: '${{ parameters.artifactBuildID }}'
  